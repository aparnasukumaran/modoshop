{% extends "base.html" %}
{% block content %}
<div class="container mb-5 mt-5 py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">


            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fw-bold">Checkout</h3>
                <a href="{% url 'cart_page' %}" class="btn btn-outline-secondary">
                    ← Go Back
                </a>
            </div>

            <!-- Checkout Card -->
            <div class="card shadow-sm rounded-4 p-4">

                {% if buy_now %}
                <h5 class="mb-3 text-dark fw-bold">Buying Single Product</h5>
                {% else %}
                <h5 class="mb-3 text-dark fw-bold ">Cart Summary</h5>
                {% endif %}

                <!-- Items List -->
                <ul class="list-group mb-3">
                    {% for item in items %}
                    <li class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 py-2">

                        <!-- Product Info -->
                        <div class="d-flex align-items-center gap-2" style="flex: 2;">
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" width="50" height="50"
                                class="rounded">
                            <strong>{{ item.product.name }}</strong>
                        </div>

                        <!-- Quantity Controls -->
                        <div style="flex: 1; text-align: center;">
                            {% if buy_now %}
                            Quantity: {{ item.quantity }}
                            {% else %}
                            <div class="d-flex align-items-center gap-2" style="flex: 1; justify-content: center;">
                                <!-- Decrease Quantity -->
                                <form action="{% url 'update_quantity' item.id %}?next=checkout" method="POST"
                                    style="display:inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="decrease">
                                    <button type="submit" class="btn btn-sm btn-outline-secondary px-2">-</button>
                                </form>

                                <span class="px-2">{{ item.quantity }}</span>

                                <!-- Increase Quantity -->
                                <form action="{% url 'update_quantity' item.id %}?next=checkout" method="POST"
                                    style="display:inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="increase">
                                    <button type="submit" class="btn btn-sm btn-outline-secondary px-2">+</button>
                                </form>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Total Price -->
                        <span style="flex: 1; text-align: right;">₹{{ item.total_price|floatformat:2 }}</span>
                    </li>

                    {% endfor %}
                </ul>


                <!-- Summary -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal:</span>
                        <span>₹{{ subtotal|floatformat:2 }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>GST :</span>
                        <span>₹{{ gst_amount|floatformat:2 }}</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between fw-bold fs-5">
                        <span>Total:</span>
                        <span>₹{{ total_amount|floatformat:2 }}</span>
                    </div>
                </div>

                <!-- Payment Options -->
                <form method="POST" id="checkoutForm">
                    {% csrf_token %}


                    <div class="mb-3 ">
                        <label for="address" class="form-label">Shipping Address:</label>
                        <textarea class="form-control shadow-none" id="address" name="address" rows="3"
                            required></textarea>
                    </div>


                    <h5 class="mb-3">Payment Method</h5>

                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="payment_method" id="cod" value="COD" checked>
                        <label class="form-check-label" for="cod">
                            Cash on Delivery
                        </label>
                    </div>

                    <div class="form-check mb-4">
                        <input class="form-check-input" type="radio" name="payment_method" id="online" value="ONLINE">
                        <label class="form-check-label" for="online">
                            Pay Online
                        </label>
                    </div>

                    <!-- Terms & Privacy Checkbox -->
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="termsCheckbox">
                        <label class="form-check-label" for="termsCheckbox">
                            I agree to the <a href="{% url 'terms_of_service' %}" target="_blank">Terms of Service</a>
                            and
                            <a href="{% url 'privacy_policy' %}" target="_blank">Privacy Policy</a>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-success w-100" id="placeOrderBtn" disabled>
                        Place Order
                    </button>
                </form>

            </div>

        </div>
    </div>
</div>

<script>
    const checkbox = document.getElementById('termsCheckbox');
    const placeOrderBtn = document.getElementById('placeOrderBtn');

    checkbox.addEventListener('change', function () {
        placeOrderBtn.disabled = !this.checked;
    });
</script>
{% endblock %}